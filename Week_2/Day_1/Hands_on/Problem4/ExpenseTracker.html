<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker - IndexedDB</title>
    <style>
        body {
             font-family: sans-serif;
              margin: 20px; 
              line-height: 1.5; 
            }
        .form-group {
             margin-bottom: 10px; 
            }
        label {
             display: inline-block;
              width: 100px; 
            }
        table {
             width: 100%; 
             border-collapse: collapse; 
             margin-top: 20px; 
            }
        th, td {
             border: 1px solid #ccc; 
             padding: 8px; 
             text-align: left; 
            }
        th {
             background-color: #f2f2f2; 
            }
        button 
        { 
            cursor: pointer; 
            margin: 5px 2px; 
        }
    </style>
</head>
<body onload="initDB()">

    <h2>Expense Tracker</h2>

    <div class="form-group">
        <label>Title:</label>
        <input type="text" id="title">
    </div>
    <div class="form-group">
        <label>Amount:</label>
        <input type="number" id="amount">
    </div>
    <div class="form-group">
        <label>Date:</label>
        <input type="date" id="date">
    </div>

    <button onclick="addExpense()">Add Expense</button>
    <button onclick="viewExpenses()">Refresh List</button>

    <h3>Expense Records</h3>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Amount</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="output"></tbody>
    </table>

    <script>
    let db;
function initDB() {
    let request = indexedDB.open("ExpenseTrackerDB", 1);

    request.onupgradeneeded = function(e) {
        db = e.target.result;
        db.createObjectStore("expenses", { keyPath: "id", autoIncrement: true });
        console.log("Database and Store Created");
    };

    request.onsuccess = function(e) {
        db = e.target.result;
        viewExpenses(); 
    };

    request.onerror = function() {
        console.log("Error opening DB");
    };
}

function addExpense() {
    let title = document.getElementById("title").value;
    let amount = document.getElementById("amount").value;
    let date = document.getElementById("date").value;

    if(!title || !amount || !date) {
        alert("Please fill all fields");
        return;
    }

    let tx = db.transaction("expenses", "readwrite");
    let store = tx.objectStore("expenses");

    store.add({ title: title, amount: amount, date: date });

    tx.oncomplete = function() {
        alert("Expense Added");
        document.getElementById("title").value = "";
        document.getElementById("amount").value = "";
        document.getElementById("date").value = "";
        viewExpenses();
    };

    tx.onerror = function(e) {
        console.log("Insert Error:", e.target.error);
    };
}
function viewExpenses() {
    let list = document.getElementById("output");
    list.innerHTML = "";

    let tx = db.transaction("expenses", "readonly");
    let store = tx.objectStore("expenses");

    store.openCursor().onsuccess = function(e) {
        let cursor = e.target.result;

        if(cursor) {
            let row = `<tr>
                <td>${cursor.value.id}</td>
                <td>${cursor.value.title}</td>
                <td>${cursor.value.amount}</td>
                <td>${cursor.value.date}</td>
                <td><button onclick="deleteExpense(${cursor.value.id})">Delete</button></td>
            </tr>`;
            list.innerHTML += row;
            cursor.continue();
        }
    };
}


function deleteExpense(id) {
    let tx = db.transaction("expenses", "readwrite");
    let store = tx.objectStore("expenses");

    store.delete(id);

    tx.oncomplete = function() {
        console.log("Record Deleted");
        viewExpenses(); // Refresh the display
    };

    tx.onerror = function(e) {
        alert("Delete Error: " + e.target.error);
    };
}
    </script>
</body>
</html>